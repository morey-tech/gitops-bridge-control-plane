---
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: addons
  namespace: argocd
spec:
  syncPolicy:
    preserveResourcesOnDeletion: true
  generators:
    - list:
        elements:
        - chartName: ingress-nginx
          chartRepo: https://kubernetes.github.io/ingress-nginx
          chartVersionDefault: 4.8.1
        # - chartName: ingress-nginx
        #   chartRepo: https://kubernetes.github.io/ingress-nginx
        #   chartVersionDefault: 4.8.1
    
  template:
    metadata:
      name: 'addon-{{chartName}}'
    spec:
      project: default
      source:
        # These annotations are set by Terraform.
        repoURL: '{{metadata.annotations.addons_repo_url}}'
        path: '{{metadata.annotations.addons_repo_path}}'
        targetRevision: '{{metadata.annotations.addons_repo_revision}}'
        helm:
          releaseName: {{chartName}}
          parameters:
          - name: chartName
            value: {{chartName}}
          - name: chartRepo
            value: {{chartRepo}}
          - name: chartVersionDefault
            value: {{chartVersionDefault}}
      destination:
        namespace: 'argocd'
        name: '{{name}}'
      syncPolicy:
        automated: {}
